<!DOCTYPE html>
<html lang="id">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Peta Sebaran - Regenerasi Petani</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://cdn.jsdelivr.net/npm/daisyui@4.7.2/dist/full.min.css" rel="stylesheet" />
  <script src="https://unpkg.com/alpinejs" defer></script>
  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
  <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
  <script>
    tailwind.config = {
      theme: {
        extend: {
          animation: {
            'fade-in': 'fadeIn 1s ease-in-out',
            'slide-in': 'slideIn 0.5s ease-out',
          }
        }
      }
    }
  </script>
  <style>
    @keyframes fadeIn {
      from {
        opacity: 0;
      }

      to {
        opacity: 1;
      }
    }

    @keyframes slideIn {
      from {
        transform: translateX(-20px);
        opacity: 0;
      }

      to {
        transform: translateX(0);
        opacity: 1;
      }
    }

    .leaflet-popup-content-wrapper {
      border-radius: 12px;
      box-shadow: 0 10px 25px rgba(0, 0, 0, 0.15);
    }

    .map-container {
      position: relative;
      overflow: hidden;
    }

    .map-container::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 4px;
      background: linear-gradient(90deg, #10b981, #059669);
      z-index: 1000;
    }
  </style>
</head>

<body class="bg-gray-50" x-data="mapApp()">

  <!-- Navbar -->
  <div class="navbar transition-all duration-300 bg-white shadow-lg fixed top-0 w-full z-50">
    <div class="flex-1 px-2">
      <a href="index.html" class="font-bold text-lg flex items-center space-x-2">
        <span class="text-2xl animate-bounce">ğŸŒ±</span>
        <span class="bg-gradient-to-r from-green-600 to-green-800 bg-clip-text text-transparent">Regenerasi
          Petani</span>
      </a>
    </div>

    <!-- Mobile menu button -->
    <div class="flex-none md:hidden">
      <button class="btn btn-ghost btn-circle" @click="mobileMenu = !mobileMenu">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 transition-transform"
          :class="mobileMenu ? 'rotate-90' : ''" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16" />
        </svg>
      </button>
    </div>

    <!-- Desktop menu -->
    <div class="hidden md:flex">
      <ul class="menu menu-horizontal">
        <li><a href="index.html" class="hover:text-green-600 transition-colors">Beranda</a></li>
        <li><a href="produk.html" class="hover:text-green-600 transition-colors">Produk</a></li>
        <li><a class="text-green-600 font-semibold">Peta Sebaran</a></li>
        <li><a href="#kontak" class="hover:text-green-600 transition-colors">Kontak</a></li>
      </ul>
    </div>
    <div class="flex-none hidden md:block">
      <a href="login.html" class="btn btn-success btn-sm hover:scale-105 transition-transform">Masuk</a>
    </div>

    <!-- Mobile menu -->
    <div x-show="mobileMenu" x-transition class="absolute top-full left-0 w-full bg-white shadow-lg md:hidden">
      <ul class="menu menu-vertical p-2">
        <li><a href="index.html">Beranda</a></li>
        <li><a href="produk.html">Produk</a></li>
        <li><a class="text-green-600 font-semibold">Peta Sebaran</a></li>
        <li><a href="#kontak">Kontak</a></li>
        <li class="mt-2"><a href="login.html" class="btn btn-success btn-sm">Masuk</a></li>
      </ul>
    </div>
  </div>

  <!-- Header Section -->
  <section class="pt-28 pb-8 bg-gradient-to-br from-green-50 via-emerald-50 to-teal-50 px-4">
    <div class="max-w-7xl mx-auto">
      <div class="text-center mb-8">
        <div
          class="inline-block px-4 py-2 bg-green-100 text-green-700 rounded-full text-sm font-medium mb-4 animate-fade-in">
          ğŸ—ºï¸ Visualisasi Data Realtime
        </div>
        <h1 class="text-3xl md:text-5xl font-bold text-green-900 mb-4 animate-fade-in">
          Peta <span class="text-green-600">Sebaran Petani</span>
        </h1>
        <p class="text-gray-600 text-lg max-w-3xl mx-auto animate-fade-in">
          Jelajahi distribusi petani dan komoditas unggulan di seluruh Sulawesi Tengah dengan visualisasi interaktif
          yang
          komprehensif
        </p>
      </div>

      <!-- Stats Cards -->
      <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-8">
        <div class="bg-white rounded-xl p-4 shadow-lg text-center animate-slide-in">
          <div class="text-2xl font-bold text-blue-600" x-text="stats.total"></div>
          <div class="text-sm text-gray-600">Total Petani</div>
        </div>
        <div class="bg-white rounded-xl p-4 shadow-lg text-center animate-slide-in" style="animation-delay: 0.1s">
          <div class="text-2xl font-bold text-green-600" x-text="stats.active"></div>
          <div class="text-sm text-gray-600">Petani Aktif</div>
        </div>
        <div class="bg-white rounded-xl p-4 shadow-lg text-center animate-slide-in" style="animation-delay: 0.2s">
          <div class="text-2xl font-bold text-purple-600" x-text="stats.commodities"></div>
          <div class="text-sm text-gray-600">Komoditas</div>
        </div>
        <div class="bg-white rounded-xl p-4 shadow-lg text-center animate-slide-in" style="animation-delay: 0.3s">
          <div class="text-2xl font-bold text-orange-600" x-text="stats.regions"></div>
          <div class="text-sm text-gray-600">Kabupaten</div>
        </div>
      </div>
    </div>
  </section>

  <!-- Main Content -->
  <section class="pb-8 px-4">
    <div class="max-w-7xl mx-auto">
      <div class="grid lg:grid-cols-4 gap-6 h-[600px]">

        <!-- Sidebar Filter -->
        <aside class="lg:col-span-1">
          <div class="bg-white rounded-xl shadow-lg p-6 h-full overflow-y-auto animate-slide-in">
            <h2 class="font-bold text-xl mb-6 flex items-center">
              <span class="mr-2">ğŸ›ï¸</span> Filter Peta
            </h2>

            <!-- Search -->
            <div class="mb-6">
              <label class="block font-semibold mb-3 text-gray-700">Pencarian</label>
              <div class="relative">
                <input type="text" x-model="searchTerm" placeholder="Cari petani, daerah..."
                  class="input input-bordered w-full pl-10 pr-4" />
                <div class="absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400">ğŸ”</div>
              </div>
            </div>

            <!-- Dinas Teknis -->
            <div class="mb-6">
              <label class="block font-semibold mb-3 text-gray-700">Dinas Teknis</label>
              <div class="space-y-2">
                <template x-for="dinas in dinasOptions" :key="dinas.code">
                  <label class="flex items-center cursor-pointer hover:bg-gray-50 p-2 rounded">
                    <input type="checkbox" :value="dinas.code" x-model="selectedDinas"
                      class="checkbox checkbox-success checkbox-sm mr-3" />
                    <div>
                      <div class="font-medium text-sm" x-text="dinas.name"></div>
                      <div class="text-xs text-gray-500" x-text="dinas.count + ' petani'"></div>
                    </div>
                  </label>
                </template>
              </div>
            </div>

            <!-- Status Keaktifan -->
            <div class="mb-6">
              <label class="block font-semibold mb-3 text-gray-700">Status Keaktifan</label>
              <div class="space-y-2">
                <label class="flex items-center cursor-pointer hover:bg-gray-50 p-2 rounded">
                  <input type="checkbox" value="aktif" x-model="selectedStatus"
                    class="checkbox checkbox-success checkbox-sm mr-3" />
                  <div class="flex items-center">
                    <div class="w-3 h-3 bg-green-500 rounded-full mr-2"></div>
                    <span class="text-sm">Aktif</span>
                  </div>
                </label>
                <label class="flex items-center cursor-pointer hover:bg-gray-50 p-2 rounded">
                  <input type="checkbox" value="tidak-aktif" x-model="selectedStatus"
                    class="checkbox checkbox-error checkbox-sm mr-3" />
                  <div class="flex items-center">
                    <div class="w-3 h-3 bg-red-500 rounded-full mr-2"></div>
                    <span class="text-sm">Tidak Aktif</span>
                  </div>
                </label>
              </div>
            </div>

            <!-- Komoditas -->
            <div class="mb-6">
              <label class="block font-semibold mb-3 text-gray-700">Komoditas</label>
              <select x-model="selectedCommodity" class="select select-bordered w-full select-sm">
                <option value="">Semua Komoditas</option>
                <template x-for="commodity in commodities" :key="commodity">
                  <option :value="commodity" x-text="commodity"></option>
                </template>
              </select>
            </div>

            <!-- Wilayah -->
            <div class="mb-6">
              <label class="block font-semibold mb-3 text-gray-700">Kabupaten/Kota</label>
              <select x-model="selectedRegion" class="select select-bordered w-full select-sm">
                <option value="">Semua Wilayah</option>
                <template x-for="region in regions" :key="region">
                  <option :value="region" x-text="region"></option>
                </template>
              </select>
            </div>

            <!-- Layer Control -->
            <div class="mb-6">
              <label class="block font-semibold mb-3 text-gray-700">Layer Peta</label>
              <div class="space-y-2">
                <label class="flex items-center">
                  <input type="checkbox" x-model="showHeatmap" class="checkbox checkbox-sm mr-2" />
                  <span class="text-sm">Heatmap Kepadatan</span>
                </label>
                <label class="flex items-center">
                  <input type="checkbox" x-model="showClusters" class="checkbox checkbox-sm mr-2" />
                  <span class="text-sm">Cluster Markers</span>
                </label>
              </div>
            </div>

            <button @click="resetFilters()" class="btn btn-outline btn-sm w-full">
              Reset Filter
            </button>
          </div>
        </aside>

        <!-- Map Container -->
        <div class="lg:col-span-3">
          <div class="bg-white rounded-xl shadow-lg overflow-hidden h-full map-container animate-fade-in">
            <!-- Map Header -->
            <div class="p-4 bg-gradient-to-r from-green-50 to-emerald-50 border-b">
              <div class="flex justify-between items-center">
                <div>
                  <h3 class="font-bold text-lg text-gray-900">Peta Interaktif</h3>
                  <p class="text-sm text-gray-600">
                    Menampilkan <span x-text="filteredFarmers.length" class="font-semibold text-green-600"></span>
                    petani
                  </p>
                </div>
                <div class="flex space-x-2">
                  <button @click="centerMap()" class="btn btn-ghost btn-sm" title="Kembali ke pusat">
                    ğŸ¯
                  </button>
                  <button @click="toggleFullscreen()" class="btn btn-ghost btn-sm" title="Fullscreen">
                    ğŸ”²
                  </button>
                  <div class="dropdown dropdown-end">
                    <div tabindex="0" role="button" class="btn btn-ghost btn-sm">âš™ï¸</div>
                    <ul tabindex="0" class="dropdown-content menu bg-white rounded-box z-[1] w-52 p-2 shadow-lg">
                      <li><a @click="exportData()">ğŸ“Š Export Data</a></li>
                      <li><a @click="shareMap()">ğŸ”— Share Map</a></li>
                    </ul>
                  </div>
                </div>
              </div>
            </div>

            <!-- Map -->
            <div id="map" class="w-full flex-1" style="height: calc(100% - 80px);"></div>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- Info Cards -->
  <section class="py-12 px-4 bg-white">
    <div class="max-w-7xl mx-auto">
      <div class="grid md:grid-cols-3 gap-8">
        <div class="text-center p-6 bg-gradient-to-br from-blue-50 to-blue-100 rounded-xl">
          <div class="text-4xl mb-4">ğŸ“</div>
          <h3 class="font-bold text-xl mb-2">Real-time Data</h3>
          <p class="text-gray-600">Data petani dan komoditas diperbarui secara real-time untuk akurasi maksimal</p>
        </div>
        <div class="text-center p-6 bg-gradient-to-br from-green-50 to-green-100 rounded-xl">
          <div class="text-4xl mb-4">ğŸ”</div>
          <h3 class="font-bold text-xl mb-2">Analisis Mendalam</h3>
          <p class="text-gray-600">Fitur filter canggih untuk analisis sebaran petani berdasarkan berbagai kriteria</p>
        </div>
        <div class="text-center p-6 bg-gradient-to-br from-purple-50 to-purple-100 rounded-xl">
          <div class="text-4xl mb-4">ğŸ“Š</div>
          <h3 class="font-bold text-xl mb-2">Export & Share</h3>
          <p class="text-gray-600">Ekspor data dan bagikan peta untuk kolaborasi dan pelaporan</p>
        </div>
      </div>
    </div>
  </section>

  <!-- Footer -->
  <footer class="bg-green-900 text-white px-4 py-12">
    <div class="max-w-7xl mx-auto text-center">
      <div class="mb-8">
        <div class="flex items-center justify-center space-x-2 mb-4">
          <span class="text-2xl">ğŸŒ±</span>
          <span class="font-bold text-xl">Regenerasi Petani</span>
        </div>
        <p class="text-green-200 max-w-2xl mx-auto">
          Menghubungkan petani dengan teknologi modern untuk menciptakan pertanian berkelanjutan dan sejahtera.
        </p>
      </div>
      <div class="border-t border-green-800 pt-8">
        <p class="text-green-300">Â©2023 Pemerintah Provinsi Sulawesi Tengah. Semua hak dilindungi.</p>
      </div>
    </div>
  </footer>

  <script>
    function mapApp() {
      return {
        map: null,
        markers: [],
        mobileMenu: false,

        // Stats
        stats: {
          total: '10,767',
          active: '9,432',
          commodities: '125',
          regions: '27'
        },

        // Filter state
        searchTerm: '',
        selectedDinas: ['DISBUN'],
        selectedStatus: ['aktif'],
        selectedCommodity: '',
        selectedRegion: '',
        showHeatmap: false,
        showClusters: true,

        // Data
        dinasOptions: [
          { code: 'DISBUN', name: 'Dinas Perkebunan', count: 6420 },
          { code: 'DKP', name: 'Dinas Kelautan & Perikanan', count: 2156 },
          { code: 'DISPERTAPA', name: 'Dinas Pertanian & Pangan', count: 2191 }
        ],

        commodities: [
          'Kopi', 'Teh', 'Padi', 'Jagung', 'Kedelai', 'Cabai', 'Tomat', 'Bawang',
          'Pisang', 'Mangga', 'Jeruk', 'Kelapa', 'Cengkeh', 'Lada'
        ],

        regions: [
          'Bandung', 'Subang', 'Karawang', 'Garut', 'Tasikmalaya', 'Cianjur',
          'Sukabumi', 'Bogor', 'Bekasi', 'Cirebon', 'Indramayu', 'Majalengka'
        ],

        farmers: [
          {
            id: 1,
            name: 'Budi Santoso',
            lat: -6.914744,
            lng: 107.60981,
            dinas: 'DISBUN',
            status: 'aktif',
            commodity: 'Kopi',
            region: 'Bandung',
            production: '2.5 ton/tahun'
          },
          {
            id: 2,
            name: 'Sari Dewi',
            lat: -6.824,
            lng: 107.509,
            dinas: 'DISBUN',
            status: 'aktif',
            commodity: 'Teh',
            region: 'Bandung',
            production: '1.8 ton/tahun'
          },
          {
            id: 3,
            name: 'Ahmad Rizky',
            lat: -7.1628,
            lng: 107.9039,
            dinas: 'DISPERTAPA',
            status: 'aktif',
            commodity: 'Padi',
            region: 'Garut',
            production: '3.2 ton/tahun'
          },
          {
            id: 4,
            name: 'Joko tombo',
            lat: -7.3506,
            lng: 108.2186,
            dinas: 'DISBUN',
            status: 'tidak-aktif',
            commodity: 'Kelapa',
            region: 'Tasikmalaya',
            production: '1.5 ton/tahun'
          },
          {
            id: 5,
            name: 'Rina Sari',
            lat: -6.3,
            lng: 107.3,
            dinas: 'DISPERTAPA',
            status: 'aktif',
            commodity: 'Jagung',
            region: 'Subang',
            production: '4.1 ton/tahun'
          }
        ],

        get filteredFarmers() {
          return this.farmers.filter(farmer => {
            const matchesSearch = !this.searchTerm ||
              farmer.name.toLowerCase().includes(this.searchTerm.toLowerCase()) ||
              farmer.region.toLowerCase().includes(this.searchTerm.toLowerCase());

            const matchesDinas = this.selectedDinas.length === 0 ||
              this.selectedDinas.includes(farmer.dinas);

            const matchesStatus = this.selectedStatus.length === 0 ||
              this.selectedStatus.includes(farmer.status);

            const matchesCommodity = !this.selectedCommodity ||
              farmer.commodity === this.selectedCommodity;

            const matchesRegion = !this.selectedRegion ||
              farmer.region === this.selectedRegion;

            return matchesSearch && matchesDinas && matchesStatus && matchesCommodity && matchesRegion;
          });
        },

        init() {
          this.$nextTick(() => {
            this.initMap();
          });
        },

        initMap() {
          // Initialize Leaflet map
          this.map = L.map('map').setView([-6.914744, 107.60981], 9);

          // Add tile layer
          L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
          }).addTo(this.map);

          // Add custom controls
          this.addCustomControls();

          // Initial marker update
          this.updateMarkers();

          // Watch for filter changes
          this.$watch('filteredFarmers', () => {
            this.updateMarkers();
          });
        },

        addCustomControls() {
          // Add legend control
          const legend = L.control({ position: 'bottomright' });
          legend.onAdd = function (map) {
            const div = L.DomUtil.create('div', 'info legend');
            div.innerHTML = `
              <div class="bg-white p-3 rounded-lg shadow-lg">
                <h4 class="font-bold mb-2">Legenda</h4>
                <div class="space-y-1 text-sm">
                  <div><span class="w-3 h-3 bg-green-500 rounded-full inline-block mr-2"></span>Aktif</div>
                  <div><span class="w-3 h-3 bg-red-500 rounded-full inline-block mr-2"></span>Tidak Aktif</div>
                </div>
              </div>
            `;
            return div;
          };
          legend.addTo(this.map);
        },

        updateMarkers() {
          // Clear existing markers
          this.markers.forEach(marker => this.map.removeLayer(marker));
          this.markers = [];

          // Add new markers
          this.filteredFarmers.forEach(farmer => {
            const marker = L.marker([farmer.lat, farmer.lng], {
              icon: L.divIcon({
                html: `
                  <div class="w-8 h-8 rounded-full flex items-center justify-center text-white font-bold shadow-lg transition-transform hover:scale-110" 
                       style="background-color: ${farmer.status === 'aktif' ? '#10b981' : '#ef4444'}">
                    ${farmer.name.charAt(0)}
                  </div>
                `,
                className: '',
                iconSize: [32, 32]
              })
            });

            marker.bindPopup(`
              <div class="p-3 min-w-[200px]">
                <h3 class="font-bold text-lg text-gray-900 mb-2">${farmer.name}</h3>
                <div class="space-y-2 text-sm">
                  <div class="flex justify-between">
                    <span class="text-gray-600">Dinas:</span>
                    <span class="font-semibold">${farmer.dinas}</span>
                  </div>
                  <div class="flex justify-between">
                    <span class="text-gray-600">Komoditas:</span>
                    <span class="font-semibold">${farmer.commodity}</span>
                  </div>
                  <div class="flex justify-between">
                    <span class="text-gray-600">Wilayah:</span>
                    <span class="font-semibold">${farmer.region}</span>
                  </div>
                  <div class="flex justify-between">
                    <span class="text-gray-600">Produksi:</span>
                    <span class="font-semibold">${farmer.production}</span>
                  </div>
                  <div class="flex justify-between">
                    <span class="text-gray-600">Status:</span>
                    <span class="px-2 py-1 rounded-full text-xs font-semibold ${farmer.status === 'aktif' ? 'bg-green-100 text-green-800' : 'bg-red-100 text-red-800'}">
                      ${farmer.status === 'aktif' ? 'Aktif' : 'Tidak Aktif'}
                    </span>
                  </div>
                </div>
                <div class="mt-3 pt-3 border-t">
                  <button class="btn btn-success btn-sm w-full">Lihat Detail</button>
                </div>
              </div>
            `);

            marker.addTo(this.map);
            this.markers.push(marker);
          });
        },

        centerMap() {
          this.map.setView([-6.914744, 107.60981], 9);
        },

        toggleFullscreen() {
          const mapContainer = document.getElementById('map').parentElement;
          if (!document.fullscreenElement) {
            mapContainer.requestFullscreen();
          } else {
            document.exitFullscreen();
          }
        },

        exportData() {
          const data = this.filteredFarmers.map(farmer => ({
            nama: farmer.name,
            dinas: farmer.dinas,
            komoditas: farmer.commodity,
            wilayah: farmer.region,
            status: farmer.status,
            produksi: farmer.production
          }));

          const csv = [
            Object.keys(data[0]).join(','),
            ...data.map(row => Object.values(row).join(','))
          ].join('\n');

          const blob = new Blob([csv], { type: 'text/csv' });
          const url = window.URL.createObjectURL(blob);
          const a = document.createElement('a');
          a.href = url;
          a.download = 'data-petani.csv';
          a.click();
        },

        shareMap() {
          if (navigator.share) {
            navigator.share({
              title: 'Peta Sebaran Petani - Regenerasi Petani',
              text: 'Lihat peta sebaran petani di Sulawesi Tengah',
              url: window.location.href
            });
          } else {
            navigator.clipboard.writeText(window.location.href);
            alert('Link peta telah disalin ke clipboard!');
          }
        },

        resetFilters() {
          this.searchTerm = '';
          this.selectedDinas = ['DISBUN'];
          this.selectedStatus = ['aktif'];
          this.selectedCommodity = '';
          this.selectedRegion = '';
          this.showHeatmap = false;
          this.showClusters = true;
        }
      }
    }
  </script>

</body>

</html>